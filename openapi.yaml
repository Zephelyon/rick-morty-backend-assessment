openapi: 3.0.3
info:
  title: Rick & Morty API (GraphQL) — Redocly Documentation
  version: 1.2.0
  description: |
    Rick & Morty GraphQL API exposed through a single HTTP endpoint. Results are cached in Redis and persisted in PostgreSQL.

    1. Basics
    - HTTP endpoint (GraphQL over HTTP): POST /api/rick-and-morty
    - Owner: @Andrés Arango

    2. What’s included (updated)
    In addition to the search/filter query, a complete CRUD for Characters is available. All operations are GraphQL and use the same HTTP endpoint:
    - Query getCharactersRickAndMorty(filter: CharacterFilterInput): [Character]
    - Query getCharacterById(id: Int!): Character
    - Mutation createCharacter(input: CharacterCreateInput!): Character
    - Mutation updateCharacter(id: Int!, input: CharacterUpdateInput!): Character
    - Mutation deleteCharacter(id: Int!): Boolean

    3. How to call
    Send a JSON body containing "query", optional "variables", and optional "operationName" to the endpoint.

    4. Quick GraphQL snippets

    - getCharactersRickAndMorty
    ```graphql
    query ($filter: CharacterFilterInput) {
      getCharactersRickAndMorty(filter: $filter) {
        id
        name
        status
        species
        gender
        origin
      }
    }
    ```

    - getCharacterById
    ```graphql
    query ($id: Int!) {
      getCharacterById(id: $id) {
        id
        name
        status
        species
        gender
        origin
      }
    }
    ```

    - createCharacter
    ```graphql
    mutation ($input: CharacterCreateInput!) {
      createCharacter(input: $input) {
        id
        name
        status
        species
        gender
        origin
      }
    }
    ```

    - updateCharacter
    ```graphql
    mutation ($id: Int!, $input: CharacterUpdateInput!) {
      updateCharacter(id: $id, input: $input) {
        id
        name
        status
        species
        gender
        origin
      }
    }
    ```

    - deleteCharacter
    ```graphql
    mutation ($id: Int!) {
      deleteCharacter(id: $id)
    }
    ```

    5. Key notes
    - Filter cache is automatically invalidated on write operations (create, update, delete).
    - Inputs are validated with class-validator; see limits in the schemas below.
    - Documentation is served at /docs (Redocly) and the YAML at /openapi.yaml
    - Tip: In GraphQL Playground at /api/rick-and-morty, paste the query on the left and the Variables JSON on the right (Query variables).
  contact:
    name: Rick & Morty Project
servers:
  - url: http://localhost:{port}
    description: Local server
    variables:
      port:
        default: "3000"
tags:
  - name: GraphQL
    description: Execute GraphQL operations for Characters.
x-tagGroups:
  - name: Rick & Morty API (GraphQL)
    tags:
      - GraphQL
paths:
  /api/rick-and-morty:
    post:
      summary: Execute GraphQL operation (Queries/Mutations)
      operationId: postGraphQL
      description: |
        Send GraphQL queries and mutations using a single HTTP endpoint.

        Example: search with filters (getCharactersRickAndMorty):
        ```graphql
        query ($filter: CharacterFilterInput) {
          getCharactersRickAndMorty(filter: $filter) {
            id
            name
            status
            species
            gender
            origin
          }
        }
        ```
      tags: [GraphQL]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                query:
                  type: string
                  description: String containing the GraphQL query or mutation.
                variables:
                  type: object
                  description: Variables map.
                operationName:
                  type: string
                  description: Operation name (optional when only one operation is sent).
              required: [query]
            examples:
              getCharactersRickAndMorty:
                summary: Search with filters
                value:
                  query: |-
                    query ($filter: CharacterFilterInput) { getCharactersRickAndMorty(filter: $filter) { id name status species gender origin } }
                  variables:
                    filter:
                      name: "Rick"
                      species: "Human"
                      status: "Alive"
                      gender: "Male"
                      origin: "Earth"
                      limit: 5
                      offset: 0
                  operationName: getCharactersRickAndMorty
              getCharacterById:
                summary: Get by id
                value:
                  query: |-
                    query ($id: Int!) { getCharacterById(id: $id) { id name status species gender origin } }
                  variables:
                    id: 1
                  operationName: getCharacterById
              createCharacter:
                summary: Create Character
                value:
                  query: |-
                    mutation ($input: CharacterCreateInput!) { createCharacter(input: $input) { id name status species gender origin } }
                  variables:
                    input:
                      name: "Birdperson"
                      status: "Alive"
                      species: "Alien"
                      gender: "Male"
                      origin: "Bird World"
                  operationName: createCharacter
              updateCharacter:
                summary: Update Character
                value:
                  query: |-
                    mutation ($id: Int!, $input: CharacterUpdateInput!) { updateCharacter(id: $id, input: $input) { id name status species gender origin } }
                  variables:
                    id: 1
                    input:
                      status: "Dead"
                      origin: null
                  operationName: updateCharacter
              deleteCharacter:
                summary: Delete Character
                value:
                  query: |-
                    mutation ($id: Int!) { deleteCharacter(id: $id) }
                  variables:
                    id: 1
                  operationName: deleteCharacter
              simpleByName:
                summary: Simple filter (name only)
                value:
                  query: |-
                    query ($filter: CharacterFilterInput) { getCharactersRickAndMorty(filter: $filter) { id name status species gender origin } }
                  variables:
                    filter:
                      name: "Rick"
      responses:
        "200":
          description: Standard GraphQL response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GraphQLResponse'
              examples:
                searchOk:
                  summary: Search result
                  value:
                    data:
                      getCharactersRickAndMorty:
                        - id: 1
                          name: Rick Sanchez
                          status: Alive
                          species: Human
                          gender: Male
                          origin: Earth (C-137)
                getByIdFound:
                  summary: getCharacterById found
                  value:
                    data:
                      getCharacterById:
                        id: 1
                        name: Rick Sanchez
                        status: Alive
                        species: Human
                        gender: Male
                        origin: Earth (C-137)
                getByIdNotFound:
                  summary: getCharacterById not found (null)
                  value:
                    data:
                      getCharacterById: null
                createOk:
                  summary: createCharacter success
                  value:
                    data:
                      createCharacter:
                        id: 21
                        name: Birdperson
                        status: Alive
                        species: Alien
                        gender: Male
                        origin: Bird World
                updateOk:
                  summary: updateCharacter success
                  value:
                    data:
                      updateCharacter:
                        id: 1
                        name: Rick Sanchez
                        status: Dead
                        species: Human
                        gender: Male
                        origin: null
                updateNotFound:
                  summary: updateCharacter on non-existent id (null)
                  value:
                    data:
                      updateCharacter: null
                deleteOk:
                  summary: deleteCharacter true
                  value:
                    data:
                      deleteCharacter: true
                deleteFalse:
                  summary: deleteCharacter false (not deleted)
                  value:
                    data:
                      deleteCharacter: false
                error:
                  summary: GraphQL error due to invalid variables
                  value:
                    errors:
                      - message: 'Variable "$filter" got invalid value { origins: "Earth" }; Field "origins" is not defined by type "CharacterFilterInput". Did you mean "origin"?'
                        path: [getCharactersRickAndMorty]
        "400":
          description: Invalid request (for example, malformed body)
components:
  schemas:
    Character:
      type: object
      properties:
        id:
          type: integer
          format: int32
        name:
          type: string
        status:
          type: string
          description: e.g., Alive, Dead, unknown
        species:
          type: string
        gender:
          type: string
        origin:
          type: string
          nullable: true
    CharacterFilterInput:
      type: object
      properties:
        name:
          type: string
        status:
          type: string
        species:
          type: string
        gender:
          type: string
        origin:
          type: string
        limit:
          type: integer
          format: int32
          minimum: 1
          maximum: 100
          default: 20
        offset:
          type: integer
          format: int32
          minimum: 0
          default: 0
    CharacterCreateInput:
      type: object
      required: [name]
      properties:
        name:
          type: string
          maxLength: 100
        status:
          type: string
          maxLength: 50
          nullable: true
        species:
          type: string
          maxLength: 100
          nullable: true
        gender:
          type: string
          maxLength: 50
          nullable: true
        origin:
          type: string
          description: Origin name
          maxLength: 100
          nullable: true
    CharacterUpdateInput:
      type: object
      properties:
        name:
          type: string
          maxLength: 100
          nullable: true
        status:
          type: string
          maxLength: 50
          nullable: true
        species:
          type: string
          maxLength: 100
          nullable: true
        gender:
          type: string
          maxLength: 50
          nullable: true
        origin:
          type: string
          description: Origin name (set null to clear)
          maxLength: 100
          nullable: true
    GraphQLError:
      type: object
      properties:
        message:
          type: string
        path:
          type: array
          items:
            oneOf:
              - type: string
              - type: integer
        locations:
          type: array
          items:
            type: object
            properties:
              line:
                type: integer
              column:
                type: integer
    GraphQLResponse:
      type: object
      properties:
        data:
          description: Object containing the requested result (shape depends on the operation).
          type: object
          additionalProperties: true
        errors:
          type: array
          items:
            $ref: '#/components/schemas/GraphQLError'
      example:
        data:
          getCharactersRickAndMorty:
            - id: 1
              name: Rick Sanchez
              status: Alive
              species: Human
              gender: Male
              origin: Earth (C-137)
